@page architecture Architecture

# MantisBase Architecture Overview

MantisBase is a modular, pluggable Backend-as-a-Service (BaaS) framework written in C++. It is designed to be lightweight, embeddable, and flexible, targeting applications that need structured data APIs, authentication, and cloud sync â€” all without heavy dependencies.

---

## ğŸ“ Core Principles

- **Pluggability**: All major subsystems (database, auth, sync) are replaceable or extendable.
- **Lightweight**: Optimized for embedded and desktop scenarios; SQLite is the default engine.
- **Modularity**: Organized into loosely coupled components for clean embedding or CLI use.
- **Sync-Aware**: Supports client/server roles with offline-first and sync-on-demand strategies.
- **Developer-First**: Embeddable as a library or deployable as a standalone binary.

---

## ğŸ§± High-Level Architecture

```
+-----------------------------+
|         Client App         |
| (Qt/CLI/Other C++ App)     |
+-------------+--------------+
              |
      embeds/links to
              â†“
+-------------+--------------+
|      MantisBase Core      |
| +------------------------+ |
| |    API Router (Crow)   | |
| |    Middleware Engine   | |
| +------------------------+ |
| |    Auth Provider       | |
| |    Sync Engine         | |
| |    Database Interface  | |
| +------------------------+ |
+-------------+--------------+
              â†“
+-----------------------------+
|     Pluggable DB Layer      |
|    (SQLite / MySQL / ...)   |
+-----------------------------+
```

---

## ğŸ§© Components

### 1. **Database Layer**
- Abstracted via `IDatabase` interface.
- Default: SQLite (in-process, lightweight)
- Optional: MySQL/PostgreSQL (via plugin or dynamic linking)

### 2. **API Router**
- Powered by http-lib (HTTP server)
- Auto-generates REST endpoints for tables/views
- Supports middleware chaining (e.g., for auth, logging)

### 3. **Authentication Module**
- Supports JWT
- Tied to access control and middleware
- Token generation and validation integrated into middleware

### 4. **Middleware System**
- Intercepts requests before/after route handlers
- Enables hooks for auth, logging, CORS, etc.
- Configurable per route or globally

### 5. **Sync Engine**
- Supports client/server sync topology
- Uses WebSocket for real-time (future) or HTTP polling

### 6. **Static File Server**
- Optional serving of static files (e.g., web UI or assets)
- Configurable static root folder

### 7. **System Tables**
- `mb_tables` â€” tracks schema
- `mb_admins` â€” Admin auth and access

---

## ğŸ”„ Sync Model

- Nodes start in either **server** or **client** mode (flag at launch)
- Client mode pulls/pushes changes to/from server
- Conflict resolution is timestamp or revision-based (configurable)
- Sync is incremental and tracked at row-level

---

## âš™ï¸ Deployment Modes

### â• Embeddable Library
- Link `libmantis.a` in your Qt/C++ project
- Use exposed headers and initialization APIs

### ğŸš€ Standalone Binary
- Run `mantisapp serve`
- Works with Docker, systemd, or embedded startup

---

## ğŸ“ File Structure Overview

```
mantisbase/
â”œâ”€â”€ include/mantisbase/  # Public API headers
â”œâ”€â”€ src/                 # Internal implementation
â”œâ”€â”€ docker/              # Dockerfile & entrypoint
â”œâ”€â”€ examples/            # Example apps embedding MantisBase
â”œâ”€â”€ tests/               # Test suite
â””â”€â”€ CMakeLists.txt
```

---

## ğŸ“Œ Extensibility Ideas

- Live schema migration tool (CLI command)
- Admin dashboard (served from static folder or separate frontend)

---

## ğŸ Conclusion

MantisBase provides a solid, portable foundation for applications that need backend features without the weight of traditional stacks. Whether embedded in a GUI tool or deployed as a syncable API server, MantisBase offers structure, simplicity, and extensibility in a small, powerful package.

