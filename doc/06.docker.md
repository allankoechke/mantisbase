@page docker Running in Docker

# Dockerizing MantisBase

MantisBase provides Docker support for easy deployment and containerization. This guide covers building and running MantisBase in Docker containers.

---

## Limitations

Docker builds are currently available for `linux-amd64` platform only. For ARM builds, you will need to build the project from source.

---

## Building and Running

### Using Dockerfile

The repository includes a `Dockerfile` in the `/docker` directory. To build and run:

```bash
docker build -t mantisbase -f docker/Dockerfile .
docker run -p 7070:7070 --rm mantisbase
```

This builds the image and starts the container, exposing MantisBase on port `80`.

### Persistent Data

By default, container restarts will clear all data. To persist data, mount volumes to the following directories:

- `/mb/data` - Database files, logs, and uploaded files
- `/mb/public` - Static files to serve
- `/mb/scripts` - JavaScript extension scripts (entry point: `index.mantis.js`)

**Example with volumes:**

```bash
docker run -p 7070:80 \
  -v $(pwd)/data:/mb/data \
  -v $(pwd)/public:/mb/public \
  -v $(pwd)/scripts:/mb/scripts \
  --rm mantisbase
```

---

## Docker Compose

A `docker-compose.yaml` file is provided for easier management:

```bash
docker compose -f docker/docker-compose.yaml up --build
```

This builds the image and starts the container with volume mounts configured.

---

## Configuration

You can configure MantisBase using environment variables or by mounting a configuration file. The container respects the same configuration options as the CLI:

- `MANTIS_JWT_SECRET` - JWT secret key for token signing
- Database connection via command-line arguments or JSON config

---

## Accessing the API

Once the container is running, access the API at:

- API Endpoints: `http://localhost:7070/api/v1/`
- Admin Dashboard: `http://localhost:7070/mb`
- Health Check: `http://localhost:7070/api/v1/health`

---

## Example: Full Setup with PostgreSQL

```yaml
version: '3.8'
services:
  mantisbase:
    build:
      context: .
      dockerfile: docker/Dockerfile
    ports:
      - "7070:7070"
    volumes:
      - ./data:/mb/data
      - ./public:/mb/public
      - ./scripts:/mb/scripts
    environment:
      - MANTIS_JWT_SECRET=your-secret-key
    command: mantisbase --database PSQL --connection "dbname=mantis host=postgres port=5432 user=postgres password=postgres" serve
    depends_on:
      - postgres
  
  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: mantis
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
```

---

## Summary

Docker provides an easy way to deploy MantisBase with consistent environments. Use volume mounts to persist data and configure the container using environment variables or command-line arguments.
